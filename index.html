<!DOCTYPE html>
<html>

<head>
    <title> Answer collector </title>
    <link rel="stylesheet" href="styles.css">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script>
        async function add(name, question, answer) {
            return new Promise(
                async (resolve, reject) => {
                    try {
                        const response = await fetch('http://' + location.hostname + ':8080/add', {
                            method: 'POST',
                            credentials: 'same-origin',
                            headers: {
                                'Content-Type': 'application/json;charset=utf-8'
                            },
                            body: JSON.stringify({
                                login: name,
                                question: question,
                                answer: answer
                            })
                        });
                        if (!response.ok) {
                            throw new Error("HTTP status " + response.status);
                        }
                        const result = await response.text();
                        resolve(result);
                    } catch (e) {
                        reject("error");
                    }
                });
        }
        async function uploadData() {
            let name = document.getElementById("nameInput").value;
            let question = document.getElementById('question').value;
            let answer = document.getElementById('answer').value;
            document.getElementById("nameInput").value = '';
            document.getElementById('question').value = '';
            document.getElementById('answer').value = '';
            let result = null;
            try {
                result = await add(name, question, answer);
                console.log(result);
            }
            catch (e) {
                console.log(e);
            }
            console.log(result  );
            if(result == "good"){
                document.getElementById("infoLabel").value = 'added';
            }else{
                document.getElementById("infoLabel").value = 'Some error! Try again.';
                document.getElementById('infoLabel').style.color = 'red';
            }
            document.getElementById('infoLabel').style.display = 'block';
            setTimeout(()=>{
                document.getElementById('infoLabel').style.display = 'none';
                document.getElementById('infoLabel').style.color = 'black';
            }, 2000)
        }
    </script>


</head>

<body>
    <div id="page-container">

        <div id="content-wrap">
            <header id="headTitle">
                <h1 id='welcomeTitle'> </h1>
            </header>

            <form id='enterForm' action='javascript: document.getElementById("enterButton").click();'>
                <label id="inputLabel1" style="font-weight: bold;">Please enter your name:</label></br>
                <input type="text" id="nameInput" placeholder="Your name.."></br>

                <label id="inputLabel2" style="font-weight: bold;">Please enter a question:</label></br>
                <textarea id="question" placeholder="Past question here" rows="4" cols="50"></textarea></br>

                <label id="inputLabel3" style="font-weight: bold;">Please enter a correct answer:</label></br>
                <textarea id="answer" placeholder="Past answer here" rows="4" cols="50"></textarea></br>

                <label id="infoLabel" style="font-weight: bold; color:red; display:none"></label></br>

                <button type="button" class="form_button" id="enterButton" onclick='uploadData();'>Enter</button>

            </form>
            <a href="/download" download="answers.txt">Download</a>
        </div>


        <footer id="discription">
            Version: 0.0</br>
            Ulaszislau Sobal&copy;2021</br>
            <a href="https://github.com/N120F2/answer-collector">Github</a>
        </footer>
    </div>
</body>

</html>